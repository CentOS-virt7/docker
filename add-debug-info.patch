From dd711a57c9d2c50382da7cfc2538b995edd86a2a Mon Sep 17 00:00:00 2001
From: Lokesh Mandvekar <lsm5@fedoraproject.org>
Date: Wed, 12 Aug 2015 19:02:33 +0000
Subject: [PATCH] debuginfo patch

From: Jan Chaloupka <jchaloup@redhat.com>
Signed-off-by: Lokesh Mandvekar <lsm5@fedoraproject.org>
---
 hack/make/.dockerinit        | 1 +
 hack/make/.dockerinit-gccgo  | 1 +
 hack/make/.ensure-httpserver | 5 ++++-
 hack/make/binary             | 1 +
 hack/make/gccgo              | 1 +
 5 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/hack/make/.dockerinit b/hack/make/.dockerinit
index 4a62ee1..d77c998 100644
--- a/hack/make/.dockerinit
+++ b/hack/make/.dockerinit
@@ -12,6 +12,7 @@ go build \
 		$LDFLAGS
 		$LDFLAGS_STATIC
 		-extldflags \"$EXTLDFLAGS_STATIC\"
+        -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./dockerinit

diff --git a/hack/make/.dockerinit-gccgo b/hack/make/.dockerinit-gccgo
index 9890863..608a138 100644
--- a/hack/make/.dockerinit-gccgo
+++ b/hack/make/.dockerinit-gccgo
@@ -13,6 +13,7 @@ go build --compiler=gccgo \
 		-Wl,--no-export-dynamic
 		$EXTLDFLAGS_STATIC_DOCKER
 		-lnetgo
+        -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./dockerinit

diff --git a/hack/make/.ensure-httpserver b/hack/make/.ensure-httpserver
index 38659ed..006ffd0 100644
--- a/hack/make/.ensure-httpserver
+++ b/hack/make/.ensure-httpserver
@@ -8,7 +8,10 @@ dir="$DEST/httpserver"
 mkdir -p "$dir"
 (
 	cd "$dir"
-	GOOS=linux GOARCH=amd64 go build -o httpserver github.com/docker/docker/contrib/httpserver
+    GOOS=linux GOARCH=amd64 go build \
+        -ldflags \
+        "-B -0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')" \
+        -o httpserver github.com/docker/docker/contrib/httpserver
 	cp ../../../../contrib/httpserver/Dockerfile .
 	docker build -qt httpserver . > /dev/null
 )
diff --git a/hack/make/binary b/hack/make/binary
index 7a3067f..1a8c671 100644
--- a/hack/make/binary
+++ b/hack/make/binary
@@ -26,6 +26,7 @@ go build \
 	-ldflags "
 		$LDFLAGS
 		$LDFLAGS_STATIC_DOCKER
+        -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./docker
 )
diff --git a/hack/make/gccgo b/hack/make/gccgo
index 972934a..d12bf79 100644
--- a/hack/make/gccgo
+++ b/hack/make/gccgo
@@ -18,6 +18,7 @@ go build -compiler=gccgo \
 		$EXTLDFLAGS_STATIC_DOCKER
 		-Wl,--no-export-dynamic
 		-ldl
+        -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./docker

-- 
2.4.3

