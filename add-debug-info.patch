From e99aa95d537595dc2de0dd0cbd675db9c7c5e946 Mon Sep 17 00:00:00 2001
From: Lokesh Mandvekar <lsm5@fedoraproject.org>
Date: Thu, 10 Sep 2015 12:16:51 -0500
Subject: [PATCH] debuginfo patch

From: Jan Chaloupka <jchaloup@redhat.com>
Signed-off-by: Lokesh Mandvekar <lsm5@fedoraproject.org>
---
 hack/make/.dockerinit        | 1 +
 hack/make/.dockerinit-gccgo  | 1 +
 hack/make/.ensure-httpserver | 9 ++++++---
 hack/make/binary             | 1 +
 hack/make/gccgo              | 1 +
 5 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/hack/make/.dockerinit b/hack/make/.dockerinit
index 4a62ee1..50c2fc4 100644
--- a/hack/make/.dockerinit
+++ b/hack/make/.dockerinit
@@ -12,6 +12,7 @@ go build \
 		$LDFLAGS
 		$LDFLAGS_STATIC
 		-extldflags \"$EXTLDFLAGS_STATIC\"
+    -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./dockerinit

diff --git a/hack/make/.dockerinit-gccgo b/hack/make/.dockerinit-gccgo
index 3caa526..6939e7b 100644
--- a/hack/make/.dockerinit-gccgo
+++ b/hack/make/.dockerinit-gccgo
@@ -13,6 +13,7 @@ go build --compiler=gccgo \
 		-Wl,--no-export-dynamic
 		$EXTLDFLAGS_STATIC
 		-lnetgo
+    -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./dockerinit

diff --git a/hack/make/.ensure-httpserver b/hack/make/.ensure-httpserver
index 38659ed..89a775d 100644
--- a/hack/make/.ensure-httpserver
+++ b/hack/make/.ensure-httpserver
@@ -8,8 +8,11 @@ dir="$DEST/httpserver"
 mkdir -p "$dir"
 (
 	cd "$dir"
-	GOOS=linux GOARCH=amd64 go build -o httpserver github.com/docker/docker/contrib/httpserver
-	cp ../../../../contrib/httpserver/Dockerfile .
-	docker build -qt httpserver . > /dev/null
+    GOOS=linux GOARCH=amd64 go build \
+        -ldflags \
+        "-B -0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')" \
+        -o httpserver github.com/docker/docker/contrib/httpserver
+    cp ../../../../contrib/httpserver/Dockerfile .
+    docker build -qt httpserver . > /dev/null
 )
 rm -rf "$dir"
diff --git a/hack/make/binary b/hack/make/binary
index 7a3067f..8fa6d7d 100644
--- a/hack/make/binary
+++ b/hack/make/binary
@@ -26,6 +26,7 @@ go build \
 	-ldflags "
 		$LDFLAGS
 		$LDFLAGS_STATIC_DOCKER
+    -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n')
 	" \
 	./docker
 )
diff --git a/hack/make/gccgo b/hack/make/gccgo
index 10b1152..d792afe 100644
--- a/hack/make/gccgo
+++ b/hack/make/gccgo
@@ -18,6 +18,7 @@ go build -compiler=gccgo \
 		$EXTLDFLAGS_STATIC
 		-Wl,--no-export-dynamic
 		-ldl
+    -B 0x$(head -c20 /dev/urandom|od -An -tx1|tr -d ' \n') 
 	" \
 	./docker

-- 
2.5.1

